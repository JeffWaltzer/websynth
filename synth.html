<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Analog Dreams Synthesizer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@500&family=Orbitron:wght@700&display=swap" rel="stylesheet">
    <style>
        body { background-color: #3a2e27; background-image: url('https://www.transparenttextures.com/patterns/wood-pattern.png'); font-family: 'Roboto Mono', monospace; display: flex; justify-content: center; align-items: flex-start; min-height: 100vh; padding: 0.5rem; -webkit-user-select: none; -ms-user-select: none; user-select: none; overflow-y: auto; touch-action: none; }
        .synth-panel { background-color: #2c221c; border: 4px solid #1a1411; border-radius: 10px; padding: 0.5rem; box-shadow: 0 10px 30px rgba(0,0,0,0.5), inset 0 0 15px rgba(0,0,0,0.4); color: #d1c7b8; width: 100%; max-width: 90rem; }
        .section-panel { background-color: #211a15; border: 2px solid #3a2e27; border-radius: 6px; padding: 0.5rem; }
        .control-group { background-color: #4a3f36; border: 2px solid #3a2e27; border-radius: 6px; padding: 0.5rem; text-transform: uppercase; display: flex; flex-direction: column; justify-content: flex-start; flex-grow: 0; flex-shrink: 1; }
        .control-group h2 { font-family: 'Orbitron', sans-serif; font-size: 0.7rem; color: #eaddcf; margin-bottom: 0.5rem; text-align: center; flex-shrink: 0; }
        .control-label { font-size: 0.55rem; color: #b0a494; letter-spacing: 0.05em; text-align: center; }
        .knob-container { display: flex; flex-direction: column; align-items: center; gap: 0.2rem; width: 100%; }
        .knob { width: 34px; height: 34px; border-radius: 50%; background: #2a2a2a; border: 2px solid #1a1a1a; position: relative; cursor: ns-resize; box-shadow: 0 2px 5px rgba(0,0,0,0.5); }
        .knob-indicator { position: absolute; width: 2px; height: 10px; background-color: #d1c7b8; top: 3px; left: 50%; transform-origin: center 14px; pointer-events: none; border-radius: 2px; }
        .p5-btn { background-color: #3d352e; color: #c7bdae; border: 2px solid #2c221c; border-radius: 4px; padding: 0.3rem 0.5rem; box-shadow: 0 2px 3px rgba(0,0,0,0.4); transition: all 0.1s ease; cursor: pointer; font-size: 0.65rem; }
        .p5-btn:hover { background-color: #52473d; }
        .p5-btn:active { transform: translateY(1px); box-shadow: 0 1px 2px rgba(0,0,0,0.4); }
        .btn-active { background-color: #c0392b; color: white; box-shadow: 0 0 10px rgba(231, 76, 60, 0.6); border-color: #e74c3c; }
        .key-white { background: linear-gradient(to bottom, #f9f9f9 0%, #e0e0e0 100%); border: 1px solid #555; box-shadow: 0 2px 2px rgba(0,0,0,0.3); }
        .key-black { background: linear-gradient(to bottom, #444 0%, #222 100%); border: 1px solid #000; box-shadow: 0 2px 2px rgba(0,0,0,0.5); }
        .key-active { background: #c0392b; }
        .mod-matrix-grid { display: grid; grid-template-columns: auto repeat(8, 1fr); gap: 0.25rem; align-items: center; }
        .mod-matrix-header { font-size: 0.6rem; text-align: center; color: #b0a494; transform: rotate(-45deg); white-space: nowrap; }
        .mod-matrix-label { font-size: 0.6rem; text-align: right; padding-right: 0.4rem; }
        .mod-matrix-toggle { width: 1.75rem; height: 1.75rem; background-color: #3d352e; border: 2px solid #2c221c; border-radius: 4px; cursor: pointer; transition: all 0.1s ease; margin: 0 auto; }
        .mod-matrix-toggle.active { background-color: #c0392b; border-color: #e74c3c; box-shadow: 0 0 8px rgba(231, 76, 60, 0.5); }
    </style>
</head>
<body>
<div class="synth-panel">
    <h1 class="text-3xl md:text-4xl font-bold mb-2 text-center font-['Orbitron'] text-amber-100 tracking-wider">ANALOG DREAMS</h1>
    <p id="audio-status" class="text-center text-yellow-400 mb-2 text-sm">Click or press a key to start audio</p>

    <div class="flex flex-col gap-1">
        <!-- Top Row: Modulation -->
        <div class="flex flex-wrap gap-1 justify-center">
            <div class="section-panel">
                <h2 class="text-center font-['Orbitron'] text-sm mb-2">LFOs</h2>
                <div class="flex flex-wrap justify-center gap-1">
                    <div class="control-group"><h3>LFO 1-3</h3><div class="flex items-center space-x-1"><div class="knob-container"><h4>1</h4><label class="control-label">Rate</label><div data-min="0.1" data-max="20" data-step="0.1" data-value="5" class="knob" id="lfo1-rate"><div class="knob-indicator"></div></div><label class="control-label mt-1">Amount</label><div data-min="0" data-max="100" data-step="1" data-value="0" class="knob" id="lfo1-amount"><div class="knob-indicator"></div></div></div><div class="knob-container"><h4>2</h4><label class="control-label">Rate</label><div data-min="0.1" data-max="20" data-step="0.1" data-value="2" class="knob" id="lfo2-rate"><div class="knob-indicator"></div></div><label class="control-label mt-1">Amount</label><div data-min="0" data-max="100" data-step="1" data-value="0" class="knob" id="lfo2-amount"><div class="knob-indicator"></div></div></div><div class="knob-container"><h4>3</h4><label class="control-label">Rate</label><div data-min="0.1" data-max="20" data-step="0.1" data-value="1" class="knob" id="lfo3-rate"><div class="knob-indicator"></div></div><label class="control-label mt-1">Amount</label><div data-min="0" data-max="100" data-step="1" data-value="0" class="knob" id="lfo3-amount"><div class="knob-indicator"></div></div></div></div></div>
                    <div class="control-group"><h3>LFO 4-6</h3><div class="flex items-center space-x-1"><div class="knob-container"><h4>4</h4><label class="control-label">Rate</label><div data-min="0.1" data-max="20" data-step="0.1" data-value="0.8" class="knob" id="lfo4-rate"><div class="knob-indicator"></div></div><label class="control-label mt-1">Amount</label><div data-min="0" data-max="100" data-step="1" data-value="0" class="knob" id="lfo4-amount"><div class="knob-indicator"></div></div></div><div class="knob-container"><h4>5</h4><label class="control-label">Rate</label><div data-min="0.1" data-max="20" data-step="0.1" data-value="0.5" class="knob" id="lfo5-rate"><div class="knob-indicator"></div></div><label class="control-label mt-1">Amount</label><div data-min="0" data-max="100" data-step="1" data-value="0" class="knob" id="lfo5-amount"><div class="knob-indicator"></div></div></div><div class="knob-container"><h4>6</h4><label class="control-label">Rate</label><div data-min="0.1" data-max="20" data-step="0.1" data-value="0.2" class="knob" id="lfo6-rate"><div class="knob-indicator"></div></div><label class="control-label mt-1">Amount</label><div data-min="0" data-max="100" data-step="1" data-value="0" class="knob" id="lfo6-amount"><div class="knob-indicator"></div></div></div></div></div>
                </div>
            </div>
            <div class="section-panel">
                <h2 class="text-center font-['Orbitron'] text-sm mb-2">Mod Matrix</h2>
                <div class="control-group"><div id="mod-matrix" class="mod-matrix-grid"><div class="mod-matrix-label"></div><div class="mod-matrix-header">LFO1</div><div class="mod-matrix-header">LFO2</div><div class="mod-matrix-header">LFO3</div><div class="mod-matrix-header">LFO4</div><div class="mod-matrix-header">LFO5</div><div class="mod-matrix-header">LFO6</div><div class="mod-matrix-header">OSC1B</div><div class="mod-matrix-header">OSC2B</div><div class="mod-matrix-label">V1 Pitch</div><button class="mod-matrix-toggle" data-source="lfo1" data-dest="v1osc"></button><button class="mod-matrix-toggle" data-source="lfo2" data-dest="v1osc"></button><button class="mod-matrix-toggle" data-source="lfo3" data-dest="v1osc"></button><button class="mod-matrix-toggle" data-source="lfo4" data-dest="v1osc"></button><button class="mod-matrix-toggle" data-source="lfo5" data-dest="v1osc"></button><button class="mod-matrix-toggle" data-source="lfo6" data-dest="v1osc"></button><button class="mod-matrix-toggle" data-source="oscb1" data-dest="v1osc"></button><button class="mod-matrix-toggle" data-source="oscb2" data-dest="v1osc"></button><div class="mod-matrix-label">V1 PW</div><button class="mod-matrix-toggle" data-source="lfo1" data-dest="v1pw"></button><button class="mod-matrix-toggle" data-source="lfo2" data-dest="v1pw"></button><button class="mod-matrix-toggle" data-source="lfo3" data-dest="v1pw"></button><button class="mod-matrix-toggle" data-source="lfo4" data-dest="v1pw"></button><button class="mod-matrix-toggle" data-source="lfo5" data-dest="v1pw"></button><button class="mod-matrix-toggle" data-source="lfo6" data-dest="v1pw"></button><button class="mod-matrix-toggle" data-source="oscb1" data-dest="v1pw"></button><button class="mod-matrix-toggle" data-source="oscb2" data-dest="v1pw"></button><div class="mod-matrix-label">V1 Filter</div><button class="mod-matrix-toggle" data-source="lfo1" data-dest="v1filter"></button><button class="mod-matrix-toggle" data-source="lfo2" data-dest="v1filter"></button><button class="mod-matrix-toggle" data-source="lfo3" data-dest="v1filter"></button><button class="mod-matrix-toggle" data-source="lfo4" data-dest="v1filter"></button><button class="mod-matrix-toggle" data-source="lfo5" data-dest="v1filter"></button><button class="mod-matrix-toggle" data-source="lfo6" data-dest="v1filter"></button><button class="mod-matrix-toggle" data-source="oscb1" data-dest="v1filter"></button><button class="mod-matrix-toggle" data-source="oscb2" data-dest="v1filter"></button><div class="mod-matrix-label">V2 Pitch</div><button class="mod-matrix-toggle" data-source="lfo1" data-dest="v2osc"></button><button class="mod-matrix-toggle" data-source="lfo2" data-dest="v2osc"></button><button class="mod-matrix-toggle" data-source="lfo3" data-dest="v2osc"></button><button class="mod-matrix-toggle" data-source="lfo4" data-dest="v2osc"></button><button class="mod-matrix-toggle" data-source="lfo5" data-dest="v2osc"></button><button class="mod-matrix-toggle" data-source="lfo6" data-dest="v2osc"></button><button class="mod-matrix-toggle" data-source="oscb1" data-dest="v2osc"></button><button class="mod-matrix-toggle" data-source="oscb2" data-dest="v2osc"></button><div class="mod-matrix-label">V2 PW</div><button class="mod-matrix-toggle" data-source="lfo1" data-dest="v2pw"></button><button class="mod-matrix-toggle" data-source="lfo2" data-dest="v2pw"></button><button class="mod-matrix-toggle" data-source="lfo3" data-dest="v2pw"></button><button class="mod-matrix-toggle" data-source="lfo4" data-dest="v2pw"></button><button class="mod-matrix-toggle" data-source="lfo5" data-dest="v2pw"></button><button class="mod-matrix-toggle" data-source="lfo6" data-dest="v2pw"></button><button class="mod-matrix-toggle" data-source="oscb1" data-dest="v2pw"></button><button class="mod-matrix-toggle" data-source="oscb2" data-dest="v2pw"></button><div class="mod-matrix-label">V2 Filter</div><button class="mod-matrix-toggle" data-source="lfo1" data-dest="v2filter"></button><button class="mod-matrix-toggle" data-source="lfo2" data-dest="v2filter"></button><button class="mod-matrix-toggle" data-source="lfo3" data-dest="v2filter"></button><button class="mod-matrix-toggle" data-source="lfo4" data-dest="v2filter"></button><button class="mod-matrix-toggle" data-source="lfo5" data-dest="v2filter"></button><button class="mod-matrix-toggle" data-source="lfo6" data-dest="v2filter"></button><button class="mod-matrix-toggle" data-source="oscb1" data-dest="v2filter"></button><button class="mod-matrix-toggle" data-source="oscb2" data-dest="v2filter"></button></div></div>
            </div>
        </div>
        <!-- Voice 1 Panel -->
        <div class="section-panel">
            <div class="flex flex-wrap gap-1">
                <div class="control-group"><h2>V1: Mixer</h2><div class="flex items-center justify-center space-x-1"><div class="knob-container"><label class="control-label">Osc A</label><div data-min="0" data-max="1" data-step="0.01" data-value="1" class="knob" id="v1-mix-osca"><div class="knob-indicator"></div></div></div><div class="knob-container"><label class="control-label">Osc B</label><div data-min="0" data-max="1" data-step="0.01" data-value="1" class="knob" id="v1-mix-oscb"><div class="knob-indicator"></div></div></div><div class="knob-container"><label class="control-label">Noise</label><div data-min="0" data-max="1" data-step="0.01" data-value="0" class="knob" id="v1-mix-noise"><div class="knob-indicator"></div></div></div></div></div>
                <div class="control-group"><h2>V1: Osc A</h2><div class="flex flex-col items-center space-y-2"><button class="p5-btn v1-waveform-btn btn-active" data-wave="pulse">Pulse</button><div class="knob-container mt-1"><label class="control-label">Pulse Width</label><div data-min="0.01" data-max="0.99" data-step="0.01" data-value="0.5" class="knob" id="v1-osc-pw"><div class="knob-indicator"></div></div></div></div></div>
                <div class="control-group"><h2>V1: Osc B</h2><div class="flex flex-col items-center space-y-1"><div class="flex space-x-1"><button class="p5-btn v1-waveform-btn-2 btn-active" data-wave="pulse">Pulse</button><button class="p5-btn v1-waveform-btn-2" data-wave="sawtooth">Saw</button><button class="p5-btn v1-waveform-btn-2" data-wave="triangle">Tri</button></div><div class="knob-container mt-1"><label class="control-label">Pulse Width</label><div data-min="0.01" data-max="0.99" data-step="0.01" data-value="0.5" class="knob" id="v1-osc2-pw"><div class="knob-indicator"></div></div></div><div class="knob-container mt-1"><label class="control-label">Fine Tune</label><div data-min="-50" data-max="50" data-step="1" data-value="0" class="knob" id="v1-osc2-freq"><div class="knob-indicator"></div></div></div></div></div>
                <div class="control-group"><h2>V1: Poly-Mod</h2><div class="flex items-center justify-center space-x-1"><div class="knob-container"><label class="control-label">F.Env Amt</label><div data-min="0" data-max="1" data-step="0.01" data-value="0" class="knob" id="v1-polymod-fenv-amt"><div class="knob-indicator"></div></div></div><div class="knob-container"><label class="control-label">OscB Amt</label><div data-min="0" data-max="1" data-step="0.01" data-value="0" class="knob" id="v1-polymod-oscb-amt"><div class="knob-indicator"></div></div></div></div><div class="mt-1 text-center"><label class="control-label">F.Env Dest</label><div class="flex space-x-1 justify-center mt-1"><button class="p5-btn v1-polymod-fenv-dest" data-dest="freq">Freq</button><button class="p5-btn v1-polymod-fenv-dest" data-dest="pw">PW</button></div></div><div class="mt-1 text-center"><label class="control-label">OscB Dest</label><div class="flex space-x-1 justify-center mt-1"><button class="p5-btn v1-polymod-oscb-dest" data-dest="freq">Freq</button><button class="p5-btn v1-polymod-oscb-dest" data-dest="pw">PW</button><button class="p5-btn v1-polymod-oscb-dest" data-dest="filter">Filt</button></div></div></div>
                <div class="control-group"><h2>V1: Filter & Env</h2><div class="flex items-center justify-center space-x-1"><div class="knob-container"><label class="control-label">Cutoff</label><div data-min="20" data-max="20000" data-step="1" data-value="5000" class="knob" id="v1-filter-cutoff"><div class="knob-indicator"></div></div></div><div class="knob-container"><label class="control-label">Resonance</label><div data-min="0" data-max="30" data-step="0.1" data-value="5" class="knob" id="v1-filter-resonance"><div class="knob-indicator"></div></div></div><div class="knob-container"><label class="control-label">Env Amt</label><div data-min="-4800" data-max="4800" data-step="1" data-value="1200" class="knob" id="v1-filter-env"><div class="knob-indicator"></div></div></div></div><div class="grid grid-cols-4 gap-1 mt-2"><div class="knob-container"><label class="control-label">Attack</label><div data-min="0.01" data-max="2" data-step="0.01" data-value="0.1" class="knob" id="v1-fenv-attack"><div class="knob-indicator"></div></div></div><div class="knob-container"><label class="control-label">Decay</label><div data-min="0.01" data-max="2" data-step="0.01" data-value="0.5" class="knob" id="v1-fenv-decay"><div class="knob-indicator"></div></div></div><div class="knob-container"><label class="control-label">Sustain</label><div data-min="0" data-max="1" data-step="0.01" data-value="0.5" class="knob" id="v1-fenv-sustain"><div class="knob-indicator"></div></div></div><div class="knob-container"><label class="control-label">Release</label><div data-min="0.01" data-max="5" data-step="0.01" data-value="1" class="knob" id="v1-fenv-release"><div class="knob-indicator"></div></div></div></div></div>
                <div class="control-group"><h2>V1: Amp Env</h2><div class="grid grid-cols-2 gap-1"><div class="knob-container"><label class="control-label">Attack</label><div data-min="0.01" data-max="2" data-step="0.01" data-value="0.1" class="knob" id="v1-aenv-attack"><div class="knob-indicator"></div></div></div><div class="knob-container"><label class="control-label">Decay</label><div data-min="0.01" data-max="2" data-step="0.01" data-value="0.5" class="knob" id="v1-aenv-decay"><div class="knob-indicator"></div></div></div><div class="knob-container"><label class="control-label">Sustain</label><div data-min="0" data-max="1" data-step="0.01" data-value="0.5" class="knob" id="v1-aenv-sustain"><div class="knob-indicator"></div></div></div><div class="knob-container"><label class="control-label">Release</label><div data-min="0.01" data-max="5" data-step="0.01" data-value="1" class="knob" id="v1-aenv-release"><div class="knob-indicator"></div></div></div></div></div>
            </div>
        </div>
        <!-- Voice 2 Panel -->
        <div class="section-panel">
            <div class="flex flex-wrap gap-1">
                <div class="control-group"><h2>V2: Mixer</h2><div class="flex items-center justify-center space-x-1"><div class="knob-container"><label class="control-label">Osc A</label><div data-min="0" data-max="1" data-step="0.01" data-value="1" class="knob" id="v2-mix-osca"><div class="knob-indicator"></div></div></div><div class="knob-container"><label class="control-label">Osc B</label><div data-min="0" data-max="1" data-step="0.01" data-value="1" class="knob" id="v2-mix-oscb"><div class="knob-indicator"></div></div></div><div class="knob-container"><label class="control-label">Noise</label><div data-min="0" data-max="1" data-step="0.01" data-value="0" class="knob" id="v2-mix-noise"><div class="knob-indicator"></div></div></div></div></div>
                <div class="control-group"><h2>V2: Osc A</h2><div class="flex flex-col items-center space-y-2"><button class="p5-btn v2-waveform-btn btn-active" data-wave="pulse">Pulse</button><div class="knob-container mt-1"><label class="control-label">Pulse Width</label><div data-min="0.01" data-max="0.99" data-step="0.01" data-value="0.5" class="knob" id="v2-osc-pw"><div class="knob-indicator"></div></div></div></div></div>
                <div class="control-group"><h2>V2: Osc B</h2><div class="flex flex-col items-center space-y-1"><div class="flex space-x-1"><button class="p5-btn v2-waveform-btn-2 btn-active" data-wave="pulse">Pulse</button><button class="p5-btn v2-waveform-btn-2" data-wave="sawtooth">Saw</button><button class="p5-btn v2-waveform-btn-2" data-wave="triangle">Tri</button></div><div class="knob-container mt-1"><label class="control-label">Pulse Width</label><div data-min="0.01" data-max="0.99" data-step="0.01" data-value="0.5" class="knob" id="v2-osc2-pw"><div class="knob-indicator"></div></div></div><div class="knob-container mt-1"><label class="control-label">Fine Tune</label><div data-min="-50" data-max="50" data-step="1" data-value="0" class="knob" id="v2-osc2-freq"><div class="knob-indicator"></div></div></div></div></div>
                <div class="control-group"><h2>V2: Poly-Mod</h2><div class="flex items-center justify-center space-x-1"><div class="knob-container"><label class="control-label">F.Env Amt</label><div data-min="0" data-max="1" data-step="0.01" data-value="0" class="knob" id="v2-polymod-fenv-amt"><div class="knob-indicator"></div></div></div><div class="knob-container"><label class="control-label">OscB Amt</label><div data-min="0" data-max="1" data-step="0.01" data-value="0" class="knob" id="v2-polymod-oscb-amt"><div class="knob-indicator"></div></div></div></div><div class="mt-1 text-center"><label class="control-label">F.Env Dest</label><div class="flex space-x-1 justify-center mt-1"><button class="p5-btn v2-polymod-fenv-dest" data-dest="freq">Freq</button><button class="p5-btn v2-polymod-fenv-dest" data-dest="pw">PW</button></div></div><div class="mt-1 text-center"><label class="control-label">OscB Dest</label><div class="flex space-x-1 justify-center mt-1"><button class="p5-btn v2-polymod-oscb-dest" data-dest="freq">Freq</button><button class="p5-btn v2-polymod-oscb-dest" data-dest="pw">PW</button><button class="p5-btn v2-polymod-oscb-dest" data-dest="filter">Filt</button></div></div></div>
                <div class="control-group"><h2>V2: Filter & Env</h2><div class="flex items-center justify-center space-x-1"><div class="knob-container"><label class="control-label">Cutoff</label><div data-min="20" data-max="20000" data-step="1" data-value="5000" class="knob" id="v2-filter-cutoff"><div class="knob-indicator"></div></div></div><div class="knob-container"><label class="control-label">Resonance</label><div data-min="0" data-max="30" data-step="0.1" data-value="5" class="knob" id="v2-filter-resonance"><div class="knob-indicator"></div></div></div><div class="knob-container"><label class="control-label">Env Amt</label><div data-min="-4800" data-max="4800" data-step="1" data-value="1200" class="knob" id="v2-filter-env"><div class="knob-indicator"></div></div></div></div><div class="grid grid-cols-4 gap-1 mt-2"><div class="knob-container"><label class="control-label">Attack</label><div data-min="0.01" data-max="2" data-step="0.01" data-value="0.1" class="knob" id="v2-fenv-attack"><div class="knob-indicator"></div></div></div><div class="knob-container"><label class="control-label">Decay</label><div data-min="0.01" data-max="2" data-step="0.01" data-value="0.5" class="knob" id="v2-fenv-decay"><div class="knob-indicator"></div></div></div><div class="knob-container"><label class="control-label">Sustain</label><div data-min="0" data-max="1" data-step="0.01" data-value="0.5" class="knob" id="v2-fenv-sustain"><div class="knob-indicator"></div></div></div><div class="knob-container"><label class="control-label">Release</label><div data-min="0.01" data-max="5" data-step="0.01" data-value="1" class="knob" id="v2-fenv-release"><div class="knob-indicator"></div></div></div></div></div>
                <div class="control-group"><h2>V2: Amp Env</h2><div class="grid grid-cols-2 gap-1"><div class="knob-container"><label class="control-label">Attack</label><div data-min="0.01" data-max="2" data-step="0.01" data-value="0.1" class="knob" id="v2-aenv-attack"><div class="knob-indicator"></div></div></div><div class="knob-container"><label class="control-label">Decay</label><div data-min="0.01" data-max="2" data-step="0.01" data-value="0.5" class="knob" id="v2-aenv-decay"><div class="knob-indicator"></div></div></div><div class="knob-container"><label class="control-label">Sustain</label><div data-min="0" data-max="1" data-step="0.01" data-value="0.5" class="knob" id="v2-aenv-sustain"><div class="knob-indicator"></div></div></div><div class="knob-container"><label class="control-label">Release</label><div data-min="0.01" data-max="5" data-step="0.01" data-value="1" class="knob" id="v2-aenv-release"><div class="knob-indicator"></div></div></div></div></div>
            </div>
        </div>
        <div class="flex flex-wrap gap-1 justify-center">
            <div class="section-panel"><h2>Arpeggiator & Unison</h2><div class="flex flex-wrap justify-center gap-2"><div class="control-group"><h3>Arp</h3><div class="flex items-center space-x-2"><button id="arp-on" class="p5-btn">On</button><div class="flex space-x-1"><button id="arp-mode-up" class="p5-btn arp-mode btn-active" data-mode="up">Up</button><button id="arp-mode-down" class="p5-btn arp-mode" data-mode="down">Down</button><button id="arp-mode-upDown" class="p5-btn arp-mode" data-mode="upDown">Up-Dn</button></div><div class="knob-container"><label class="control-label">Rate</label><div data-min="1" data-max="32" data-step="1" data-value="8" class="knob" id="arp-rate"><div class="knob-indicator"></div></div></div><div class="knob-container"><label class="control-label">Octaves</label><div data-min="1" data-max="4" data-step="1" data-value="1" class="knob" id="arp-octaves"><div class="knob-indicator"></div></div></div></div></div><div class="control-group"><h3>Unison</h3><div class="flex items-center space-x-2"><button id="unison-on" class="p5-btn">On</button><div class="knob-container"><label class="control-label">Detune</label><div data-min="0" data-max="50" data-step="1" data-value="10" class="knob" id="unison-detune"><div class="knob-indicator"></div></div></div></div></div></div></div>
            <div class="section-panel"><h2>Effects</h2><div class="flex items-center justify-center space-x-1"><div class="knob-container"><label class="control-label">Reverb</label><div data-min="0" data-max="1" data-step="0.01" data-value="0.1" class="knob" id="fx-reverb"><div class="knob-indicator"></div></div></div><div class="knob-container"><label class="control-label">Delay</label><div data-min="0" data-max="1" data-step="0.01" data-value="0" class="knob" id="fx-delay"><div class="knob-indicator"></div></div></div><div class="knob-container"><label class="control-label">Delay Time</label><div data-min="0.01" data-max="1" data-step="0.01" data-value="0.5" class="knob" id="fx-delay-time"><div class="knob-indicator"></div></div></div></div></div>
        </div>
        <!-- Master Keyboard & Analyzer Panel -->
        <div class="mt-1 bg-black p-2 md:p-4 rounded-md">
            <div class="section-panel mb-2">
                <h2 class="text-center font-['Orbitron'] text-sm mb-2">SPECTRUM</h2>
                <canvas id="spectrum-analyzer" class="w-full h-24"></canvas>
            </div>
            <div class="flex flex-wrap justify-center items-center gap-2 md:gap-4 mb-4"><button id="octave-down" class="p5-btn text-lg">&lt; OCT</button><span class="text-lg font-bold text-amber-200">OCT: <span id="octave-display">3</span></span><button id="octave-up" class="p5-btn text-lg">OCT &gt;</button><div class="flex items-center gap-2"><label for="midi-select" class="text-sm">MIDI:</label><select id="midi-select" class="p5-btn text-white bg-gray-700"></select></div><div class="flex items-center gap-2"><label for="midi-channel" class="text-sm">CH:</label><select id="midi-channel" class="p5-btn text-white bg-gray-700"></select></div><p id="midi-status" class="text-sm text-gray-400"></p></div>
            <div id="keyboard" class="flex justify-center select-none overflow-x-auto"></div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        let audioReady = false;
        const startAudio = async () => { if (audioReady) return; try { await Tone.start(); audioReady = true; document.getElementById('audio-status').textContent = 'Audio Ready'; document.getElementById('audio-status').style.color = '#38a169'; setupMIDI(); requestAnimationFrame(drawAnalyzer); } catch (e) { document.getElementById('audio-status').textContent = 'Browser does not support Audio'; } };
        ['click', 'keydown', 'touchstart'].forEach(evt => document.body.addEventListener(evt, startAudio, { once: true, passive: false }));

        const lfos = { lfo1: new Tone.LFO().start(), lfo2: new Tone.LFO().start(), lfo3: new Tone.LFO().start(), lfo4: new Tone.LFO().start(), lfo5: new Tone.LFO().start(), lfo6: new Tone.LFO().start() };
        const analyzer = new Tone.FFT(256);
        const masterReverb = new Tone.Reverb({ decay: 4, wet: 0.1 }).toDestination();
        const masterDelay = new Tone.PingPongDelay({ time: "4n", wet: 0, feedback: 0.5 }).connect(masterReverb);
        const masterOutput = new Tone.Gain().connect(masterDelay).connect(analyzer);

        const voices = {};
        let currentOctave = 3, currentMidiChannel = 'all';
        let arp, arpNotes = [];

        const settings = {
            v1: { mixer: {osca: 1, oscb: 1, noise: 0}, osc1: { type: 'pulse', pw: 0.5 }, osc2: { type: 'pulse', pw: 0.5, detune: 0 }, polymod: { fenv: { amt: 0, dest: {} }, oscb: { amt: 0, dest: {} } }, filter: { cutoff: 5000, resonance: 5, envAmount: 1200 }, aenv: { attack: 0.1, decay: 0.5, sustain: 0.5, release: 1 }, fenv: { attack: 0.1, decay: 0.5, sustain: 0.5, release: 1 }},
            v2: { mixer: {osca: 1, oscb: 1, noise: 0}, osc1: { type: 'pulse', pw: 0.5 }, osc2: { type: 'pulse', pw: 0.5, detune: 0 }, polymod: { fenv: { amt: 0, dest: {} }, oscb: { amt: 0, dest: {} } }, filter: { cutoff: 5000, resonance: 5, envAmount: 1200 }, aenv: { attack: 0.1, decay: 0.5, sustain: 0.5, release: 1 }, fenv: { attack: 0.1, decay: 0.5, sustain: 0.5, release: 1 }},
            lfo1: { rate: 5, amount: 0 }, lfo2: { rate: 2, amount: 0 }, lfo3: { rate: 1, amount: 0 }, lfo4: { rate: 0.8, amount: 0 }, lfo5: { rate: 0.5, amount: 0 }, lfo6: { rate: 0.2, amount: 0 },
            modMatrix: {},
            arp: { on: false, mode: 'up', rate: 8, octaves: 1 },
            unison: { on: false, detune: 10 }
        };

        function setupKnob(knob) { /* Minified knob logic */ let iY,iV;const m=parseFloat(knob.dataset.min),x=parseFloat(knob.dataset.max),s=parseFloat(knob.dataset.step);const ind=knob.querySelector('.knob-indicator');const u=v=>{ind.style.transform=`rotate(${-135+((v-m)/(x-m))*270}deg)`;};const c=dY=>{let v=iV-((dY/150)*(x-m));v=Math.max(m,Math.min(x,v));v=Math.round(v/s)*s;knob.dataset.value=v.toFixed(s<1?2:s<10?1:0);u(v);knob.dispatchEvent(new Event('input',{bubbles:true}));};const oM=e=>c(e.clientY-iY);const oT=e=>{e.preventDefault();c(e.touches[0].clientY-iY);};const oE=()=>{document.removeEventListener('mousemove',oM);document.removeEventListener('mouseup',oE);document.removeEventListener('touchmove',oT);document.removeEventListener('touchend',oE);};const oS=cY=>{iY=cY;iV=parseFloat(knob.dataset.value);document.addEventListener('mousemove',oM);document.addEventListener('mouseup',oE);document.addEventListener('touchmove',oT,{passive:false});document.addEventListener('touchend',oE);};knob.addEventListener('mousedown',e=>{e.preventDefault();oS(e.clientY);});knob.addEventListener('touchstart',e=>{e.preventDefault();oS(e.touches[0].clientY);},{passive:false});u(parseFloat(knob.dataset.value));}
        document.querySelectorAll('.knob').forEach(setupKnob);

        function setupParam(id, path) { const el = document.getElementById(id); if (el) { el.addEventListener('input', e => { let val = parseFloat(e.target.dataset.value); let obj = settings; path.slice(0, -1).forEach(p => obj = obj[p]); obj[path[path.length - 1]] = val; }); } else { console.error("Element not found: " + id); } }
        function setupWaveformButtons(selector, path) { document.querySelectorAll(selector).forEach(btn => btn.addEventListener('click', e => { document.querySelectorAll(selector).forEach(b => b.classList.remove('btn-active')); e.target.classList.add('btn-active'); let obj = settings; path.slice(0, -1).forEach(p => obj = obj[p]); obj[path[path.length - 1]] = e.target.dataset.wave; })); }
        function setupPolyModButtons(selector, path) { document.querySelectorAll(selector).forEach(btn => btn.addEventListener('click', e => { e.target.classList.toggle('btn-active'); let obj = settings; path.slice(0, -1).forEach(p => obj = obj[p]); obj[path[path.length - 1]][e.target.dataset.dest] = e.target.classList.contains('btn-active'); }));}

        ['v1', 'v2'].forEach(v => {
            ['osca', 'oscb', 'noise'].forEach(s => setupParam(`${v}-mix-${s}`, [v, 'mixer', s]));
            setupWaveformButtons(`.${v}-waveform-btn`, [v, 'osc1', 'type']);
            setupWaveformButtons(`.${v}-waveform-btn-2`, [v, 'osc2', 'type']);
            setupParam(`${v}-osc-pw`, [v, 'osc1', 'pw']); setupParam(`${v}-osc2-pw`, [v, 'osc2', 'pw']);
            setupParam(`${v}-osc2-freq`, [v, 'osc2', 'detune']);
            setupParam(`${v}-filter-cutoff`, [v, 'filter', 'cutoff']); setupParam(`${v}-filter-resonance`, [v, 'filter', 'resonance']); setupParam(`${v}-filter-env`, [v, 'filter', 'envAmount']);
            ['attack', 'decay', 'sustain', 'release'].forEach(p => { setupParam(`${v}-fenv-${p}`, [v, 'fenv', p]); setupParam(`${v}-aenv-${p}`, [v, 'aenv', p]); });
            setupParam(`${v}-polymod-fenv-amt`, [v, 'polymod', 'fenv', 'amt']); setupParam(`${v}-polymod-oscb-amt`, [v, 'polymod', 'oscb', 'amt']);
            setupPolyModButtons(`.${v}-polymod-fenv-dest`, [v, 'polymod', 'fenv', 'dest']);
            setupPolyModButtons(`.${v}-polymod-oscb-dest`, [v, 'polymod', 'oscb', 'dest']);
        });
        for(let i=1; i<=6; i++) { setupParam(`lfo${i}-rate`, [`lfo${i}`, 'rate']); setupParam(`lfo${i}-amount`, [`lfo${i}`, 'amount']); }
        document.getElementById('mod-matrix').addEventListener('click', e => { if(e.target.matches('.mod-matrix-toggle')) { e.target.classList.toggle('active'); settings.modMatrix[`${e.target.dataset.source}-${e.target.dataset.dest}`] = e.target.classList.contains('active'); } });
        document.getElementById('fx-reverb').addEventListener('input', e => masterReverb.wet.value = parseFloat(e.target.dataset.value));
        document.getElementById('fx-delay').addEventListener('input', e => masterDelay.wet.value = parseFloat(e.target.dataset.value));
        document.getElementById('fx-delay-time').addEventListener('input', e => masterDelay.delayTime.value = parseFloat(e.target.dataset.value));
        // Arp & Unison Listeners
        document.getElementById('arp-on').addEventListener('click', e => { settings.arp.on = !settings.arp.on; e.target.classList.toggle('btn-active'); if (!settings.arp.on) { arp.stop(); releaseAllArpNotes(); } });
        document.querySelectorAll('.arp-mode').forEach(btn => btn.addEventListener('click', e => { document.querySelectorAll('.arp-mode').forEach(b => b.classList.remove('btn-active')); e.target.classList.add('btn-active'); settings.arp.mode = e.target.dataset.mode; if (arp) arp.pattern = settings.arp.mode; }));
        document.getElementById('arp-rate').addEventListener('input', e => { settings.arp.rate = parseFloat(e.target.dataset.value); if (arp) arp.playbackRate = settings.arp.rate; });
        document.getElementById('arp-octaves').addEventListener('input', e => settings.arp.octaves = parseInt(e.target.dataset.value));
        document.getElementById('unison-on').addEventListener('click', e => { settings.unison.on = !settings.unison.on; e.target.classList.toggle('btn-active'); });
        document.getElementById('unison-detune').addEventListener('input', e => settings.unison.detune = parseFloat(e.target.dataset.value));

        const playNote = (note) => {
            if (!audioReady || voices[note]) return;
            const now = Tone.now(); const freq = new Tone.Frequency(note).toFrequency();

            const createVoice = (vSettings) => {
                const ampEnv = new Tone.AmplitudeEnvelope(vSettings.aenv).connect(masterOutput);
                const filter = new Tone.Filter(vSettings.filter.cutoff, 'lowpass').connect(ampEnv);
                filter.Q.value = vSettings.filter.resonance;
                const mixer = { osca: new Tone.Gain(vSettings.mixer.osca).connect(filter), oscb: new Tone.Gain(vSettings.mixer.oscb).connect(filter), noise: new Tone.Gain(vSettings.mixer.noise).connect(filter) };

                const createOsc = (settings, mixerNode, detuneOffset = 0) => {
                    let osc;
                    const oscFreq = new Tone.Frequency(freq).transpose(detuneOffset);
                    if (settings.type === 'pulse') {
                        osc = new Tone.PulseOscillator(oscFreq, settings.pw);
                    } else {
                        osc = new Tone.Oscillator(oscFreq, settings.type);
                    }
                    osc.detune.value = (settings.detune || 0);
                    osc.connect(mixerNode).start(now);
                    return osc;
                }

                const unisonOscs = [];
                if (settings.unison.on) {
                    for (let i = -1; i <= 1; i++) {
                        const detune = i * settings.unison.detune;
                        unisonOscs.push(createOsc({...vSettings.osc1, detune}, mixer.osca));
                        unisonOscs.push(createOsc({...vSettings.osc2, detune}, mixer.oscb));
                    }
                } else {
                    unisonOscs.push(createOsc({...vSettings.osc1, detune: 0}, mixer.osca));
                    unisonOscs.push(createOsc(vSettings.osc2, mixer.oscb));
                }

                const noise = new Tone.Noise("pink").connect(mixer.noise).start(now);

                const filterEnv = new Tone.FrequencyEnvelope(vSettings.fenv).connect(filter.frequency);
                filterEnv.baseFrequency = vSettings.filter.cutoff;
                filterEnv.octaves = vSettings.filter.envAmount / 1200;
                ampEnv.triggerAttack(now); filterEnv.triggerAttack(now);
                return { ampEnv, filter, mixer, unisonOscs, noise, filterEnv };
            };

            const voice1 = createVoice(settings.v1); const voice2 = createVoice(settings.v2);

            const connections = [];
            // Poly Mod, etc. ...
            voices[note] = { voice1, voice2, connections };
        };

        const stopNote = (note) => {
            if (voices[note]) {
                const voiceData = voices[note]; const now = Tone.now();
                const maxRelease = Math.max(settings.v1.aenv.release, settings.v1.fenv.release, settings.v2.aenv.release, settings.v2.fenv.release);
                voiceData.voice1.ampEnv.triggerRelease(now); voiceData.voice1.filterEnv.triggerRelease(now);
                voiceData.voice2.ampEnv.triggerRelease(now); voiceData.voice2.filterEnv.triggerRelease(now);
                setTimeout(() => {
                    const disposeVoice = v => { if (!v) return; v.unisonOscs.forEach(o => o.dispose()); v.noise.dispose(); v.ampEnv.dispose(); v.filter.dispose(); v.filterEnv.dispose(); Object.values(v.mixer).forEach(g => g.dispose()); };
                    disposeVoice(voiceData.voice1); disposeVoice(voiceData.voice2);
                    voiceData.connections.forEach(c => c.dispose());
                    Object.values(lfos).forEach(lfo => lfo.disconnect());
                }, (maxRelease + 1) * 1000);
                delete voices[note];
            }
        };

        // --- ARPEGGIATOR LOGIC ---
        function updateArpSequence() {
            if (arpNotes.length === 0) {
                arp.stop();
                return;
            }
            const notesWithOctaves = [];
            for (let i = 0; i < settings.arp.octaves; i++) {
                arpNotes.forEach(note => {
                    notesWithOctaves.push(Tone.Frequency(note).transpose(i * 12).toNote());
                });
            }
            arp.values = notesWithOctaves;
            if (Tone.Transport.state !== 'started') Tone.Transport.start();
            if (arp.state !== 'started') arp.start(0);
        }
        arp = new Tone.Sequence((time, note) => {
            playNote(note);
            // Trigger release slightly before next note to avoid overlap clicks
            setTimeout(() => stopNote(note), (Tone.Time(`16n`).toMilliseconds() * 0.9));
        }, [], "16n").start(0);
        arp.playbackRate = settings.arp.rate;
        arp.pattern = settings.arp.mode;
        Tone.Transport.stop();

        const keyboardContainer = document.getElementById('keyboard');
        const createKeyboard = () => {const kbd=document.createElement('div');kbd.className="relative flex";let whiteKeyIndex=0;for(let i=0;i<37;i++){const key=document.createElement('div');const noteIdx=i%12;const octOffset=Math.floor(i/12);const noteName=['C','C#','D','D#','E','F','F#','G','G#','A','A#','B'][noteIdx];const isBlack=noteName.includes('#');key.dataset.baseNote=noteName;key.dataset.octaveOffset=octOffset;if(isBlack){key.className='key-black w-6 h-24 md:w-7 md:h-28 rounded-b-md cursor-pointer absolute z-10';key.style.left=`${(whiteKeyIndex-0.5)*2.5}rem`;}else{key.className='key-white w-10 h-40 md:w-10 md:h-44 rounded-b-md cursor-pointer';whiteKeyIndex++;}kbd.appendChild(key);}keyboardContainer.appendChild(kbd);updateKeyboardOctave();};
        const octaveDisplay = document.getElementById('octave-display');
        const updateKeyboardOctave = () => { octaveDisplay.textContent = currentOctave; document.querySelectorAll('[data-base-note]').forEach(k => k.dataset.note = `${k.dataset.baseNote}${currentOctave + parseInt(k.dataset.octaveOffset, 10)}`); };
        document.getElementById('octave-down').addEventListener('click', () => { if (currentOctave > 1) { currentOctave--; updateKeyboardOctave(); } });
        document.getElementById('octave-up').addEventListener('click', () => { if (currentOctave < 5) { currentOctave++; updateKeyboardOctave(); } });
        createKeyboard();

        const activePointers = new Map();
        const pressKey = n => {
            if (!n) return;
            const el = document.querySelector(`[data-note="${n}"]`);
            if (settings.arp.on) {
                if (!arpNotes.includes(n)) {
                    arpNotes.push(n);
                    arpNotes.sort();
                    updateArpSequence();
                }
            } else {
                playNote(n);
            }
            if (el) el.classList.add('key-active');
        };
        const releaseKey = n => {
            if (!n) return;
            const el = document.querySelector(`[data-note="${n}"]`);
            if (settings.arp.on) {
                arpNotes = arpNotes.filter(note => note !== n);
                updateArpSequence();
            } else {
                stopNote(n);
            }
            if (el) el.classList.remove('key-active');
        };
        const releaseAllArpNotes = () => {
            arpNotes.forEach(n => {
                const el = document.querySelector(`[data-note="${n}"]`);
                if(el) el.classList.remove('key-active');
            });
            arpNotes = [];
        }
        const getNoteFromPoint = (x, y) => { const el = document.elementFromPoint(x, y); return el ? el.dataset.note : null; };
        const handlePointerDown = e => { e.preventDefault(); const note = getNoteFromPoint(e.clientX, e.clientY); if (note) { pressKey(note); activePointers.set('mouse', note); } };
        const handlePointerMove = e => { if (activePointers.has('mouse')) { e.preventDefault(); const currentNote = activePointers.get('mouse'); const noteUnderPointer = getNoteFromPoint(e.clientX, e.clientY); if (noteUnderPointer && noteUnderPointer !== currentNote) { releaseKey(currentNote); pressKey(noteUnderPointer); activePointers.set('mouse', noteUnderPointer); } } };
        const handlePointerUp = e => { if (activePointers.has('mouse')) { e.preventDefault(); releaseKey(activePointers.get('mouse')); activePointers.delete('mouse'); } };
        const handleTouchStart = e => { e.preventDefault(); for (const touch of e.changedTouches) { const note = getNoteFromPoint(touch.clientX, touch.clientY); if (note) { pressKey(note); activePointers.set(touch.identifier, note); } } };
        const handleTouchMove = e => { e.preventDefault(); for (const touch of e.changedTouches) { const lastNote = activePointers.get(touch.identifier); const noteUnderFinger = getNoteFromPoint(touch.clientX, touch.clientY); if (noteUnderFinger && noteUnderFinger !== lastNote) { releaseKey(lastNote); pressKey(noteUnderFinger); activePointers.set(touch.identifier, noteUnderFinger); } } };
        const handleTouchEnd = e => { e.preventDefault(); for (const touch of e.changedTouches) { if (activePointers.has(touch.identifier)) { releaseKey(activePointers.get(touch.identifier)); activePointers.delete(touch.identifier); } } };
        keyboardContainer.addEventListener('mousedown', handlePointerDown); document.addEventListener('mousemove', handlePointerMove); document.addEventListener('mouseup', handlePointerUp);
        keyboardContainer.addEventListener('touchstart', handleTouchStart, { passive: false }); keyboardContainer.addEventListener('touchmove', handleTouchMove, { passive: false });
        keyboardContainer.addEventListener('touchend', handleTouchEnd, { passive: false }); keyboardContainer.addEventListener('touchcancel', handleTouchEnd, { passive: false });

        const midiStatus = document.getElementById('midi-status'), midiSelect = document.getElementById('midi-select'), midiChannelSelect = document.getElementById('midi-channel');
        let midiAccess = null;
        function onMIDIMessage(event) {
            const [command, note, velocity] = event.data;
            const channel = (command & 0x0f) + 1;
            if (currentMidiChannel !== 'all' && channel !== currentMidiChannel) return;
            const noteName = Tone.Frequency(note, "midi").toNote();
            const keyElement = document.querySelector(`[data-note="${noteName}"]`);
            if ((command >> 4 === 9 || command >> 4 === 8) && keyElement) {
                if (velocity > 0 && command >> 4 === 9) pressKey(noteName);
                else releaseKey(noteName);
            }
        }
        function setupMIDI() {
            midiChannelSelect.innerHTML = '<option value="all">All</option>'; for(let i=1;i<=16;i++) midiChannelSelect.innerHTML += `<option value="${i}">${i}</option>`;
            midiChannelSelect.addEventListener('change', e => currentMidiChannel = e.target.value === 'all' ? 'all' : parseInt(e.target.value));
            if (navigator.requestMIDIAccess) navigator.requestMIDIAccess().then(onMIDISuccess, onMIDIFailure);
            else midiStatus.textContent = "WebMIDI not supported.";
        }
        function onMIDISuccess(access) {
            midiAccess = access; const inputs = midiAccess.inputs.values();
            if (midiAccess.inputs.size === 0) { midiStatus.textContent = 'No MIDI devices found.'; return; }
            midiAccess.inputs.forEach(input => midiSelect.innerHTML += `<option value="${input.id}">${input.name}</option>`);
            const setInput = (inputId) => {
                midiAccess.inputs.forEach(i => i.onmidimessage = null);
                const selectedInput = midiAccess.inputs.get(inputId);
                if(selectedInput) { selectedInput.onmidimessage = onMIDIMessage; midiStatus.textContent = `Active: ${selectedInput.name}`; }
            };
            setInput(midiSelect.options[0].value);
            midiSelect.addEventListener('change', (e) => setInput(e.target.value));
        }
        function onMIDIFailure() { midiStatus.textContent = 'Could not access MIDI devices.'; }

        // --- SPECTRUM ANALYZER ---
        const canvas = document.getElementById('spectrum-analyzer');
        const ctx = canvas.getContext('2d');
        function drawAnalyzer() {
            requestAnimationFrame(drawAnalyzer);
            if (!audioReady) return;

            const values = analyzer.getValue();
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const barWidth = canvas.width / values.length;
            ctx.fillStyle = 'rgba(231, 76, 60, 0.7)';

            for (let i = 0; i < values.length; i++) {
                const value = values[i];
                // The values are in dB, from -Infinity to 0. We'll map them to a 0-1 range.
                const normalized = (value + 100) / 100;
                const height = normalized * canvas.height;
                ctx.fillRect(i * barWidth, canvas.height - height, barWidth, height);
            }
        }
    });
</script>
</body>
</html>
